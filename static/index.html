<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StockBot — AI Stock Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: { 50:'#eef2ff',100:'#e0e7ff',500:'#6366f1',600:'#4f46e5',700:'#4338ca',900:'#312e81' },
            surface: { 800:'#1e1e2e', 700:'#2a2a3c', 600:'#353548' },
          }
        }
      }
    }
  </script>
  <style>
    body { background: #121220; font-family: 'Inter', system-ui, sans-serif; }
    .glass { background: rgba(30,30,46,0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.06); }
    .pulse-dot { animation: pulse-ring 2s ease-out infinite; }
    @keyframes pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(34,197,94,0.5); } 70% { box-shadow: 0 0 0 8px rgba(34,197,94,0); } }
    .spinner { border: 3px solid rgba(255,255,255,0.1); border-top-color: #6366f1; border-radius: 50%; width: 20px; height: 20px; animation: spin .7s linear infinite; display: inline-block; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .fade-in { animation: fadeIn .3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }
    .ai-content h1,.ai-content h2,.ai-content h3 { color: #a5b4fc; margin-top: 1em; margin-bottom: .4em; font-weight: 600; }
    .ai-content h2 { font-size: 1.1rem; }
    .ai-content h3 { font-size: 1rem; }
    .ai-content p { margin-bottom: .6em; }
    .ai-content ul,.ai-content ol { margin-left: 1.2em; margin-bottom: .6em; }
    .ai-content li { margin-bottom: .2em; }
    .ai-content strong { color: #c7d2fe; }
    .tab-active { border-color: #6366f1; color: #a5b4fc; background: rgba(99,102,241,0.1); }
    .badge { font-size: .65rem; padding: 2px 8px; border-radius: 9999px; font-weight: 600; text-transform: uppercase; letter-spacing: .05em; }
    .badge-green { background: rgba(34,197,94,.15); color: #4ade80; }
    .badge-red { background: rgba(239,68,68,.15); color: #f87171; }
    .badge-yellow { background: rgba(234,179,8,.15); color: #facc15; }
    .badge-blue { background: rgba(59,130,246,.15); color: #60a5fa; }
    input, select { background: #2a2a3c; border: 1px solid rgba(255,255,255,0.08); }
    input:focus, select:focus { outline: none; border-color: #6366f1; box-shadow: 0 0 0 2px rgba(99,102,241,0.2); }
  </style>
</head>
<body class="text-gray-300 min-h-screen">

  <!-- ── Header ─────────────────────────────────────────────── -->
  <header class="glass sticky top-0 z-50 px-6 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-9 h-9 rounded-lg bg-brand-600 flex items-center justify-center text-white font-bold text-lg">S</div>
      <div>
        <h1 class="text-white font-bold text-lg leading-tight">StockBot</h1>
        <p class="text-xs text-gray-500">AI-Powered Stock Assistant</p>
      </div>
    </div>
    <div id="health-badge" class="flex items-center gap-2 text-sm text-gray-400">
      <span class="spinner"></span> Connecting...
    </div>
  </header>

  <!-- ── Main Layout ────────────────────────────────────────── -->
  <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">

    <!-- Quick Search Bar -->
    <div class="glass rounded-xl p-4 flex gap-3">
      <input id="symbol-input" type="text" placeholder="Enter symbol (e.g. AAPL, TSLA, QQQ)"
             class="flex-1 rounded-lg px-4 py-2.5 text-white placeholder-gray-500 text-sm uppercase"
             maxlength="10" />
      <button onclick="doQuote()" class="px-5 py-2.5 bg-surface-600 hover:bg-surface-700 rounded-lg text-sm text-gray-300 transition">
        Quote
      </button>
      <button onclick="doAnalyze()" class="px-5 py-2.5 bg-brand-600 hover:bg-brand-700 rounded-lg text-sm text-white font-medium transition">
        AI Analyze
      </button>
    </div>

    <!-- Tabs -->
    <div class="flex gap-1 border-b border-white/5 overflow-x-auto">
      <button class="tab-btn tab-active px-4 py-2.5 text-sm border-b-2 border-transparent rounded-t-lg transition" data-tab="dashboard">Dashboard</button>
      <button class="tab-btn px-4 py-2.5 text-sm border-b-2 border-transparent rounded-t-lg transition text-gray-500 hover:text-gray-300" data-tab="analysis">Analysis</button>
      <button class="tab-btn px-4 py-2.5 text-sm border-b-2 border-transparent rounded-t-lg transition text-gray-500 hover:text-gray-300" data-tab="portfolio">Portfolio</button>
      <button class="tab-btn px-4 py-2.5 text-sm border-b-2 border-transparent rounded-t-lg transition text-gray-500 hover:text-gray-300" data-tab="alerts">Alerts</button>
      <button class="tab-btn px-4 py-2.5 text-sm border-b-2 border-transparent rounded-t-lg transition text-gray-500 hover:text-gray-300" data-tab="briefing">Briefing</button>
    </div>

    <!-- ═══ TAB: Dashboard ═══ -->
    <section id="tab-dashboard" class="tab-panel space-y-6 fade-in">
      <!-- Watchlist -->
      <div class="glass rounded-xl p-5">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-white font-semibold">Watchlist</h2>
          <div class="flex gap-2">
            <input id="watchlist-add-input" type="text" placeholder="Add symbol"
                   class="rounded-lg px-3 py-1.5 text-sm text-white uppercase w-28 placeholder-gray-500" maxlength="10" />
            <button onclick="addWatchlist()" class="px-3 py-1.5 bg-brand-600 hover:bg-brand-700 rounded-lg text-xs text-white transition">Add</button>
          </div>
        </div>
        <div id="watchlist-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3">
          <div class="text-gray-500 text-sm col-span-full text-center py-8">Loading watchlist...</div>
        </div>
      </div>

      <!-- Quick Quote Result -->
      <div id="quote-result" class="hidden glass rounded-xl p-5 fade-in">
        <h2 class="text-white font-semibold mb-3">Quote</h2>
        <div id="quote-body"></div>
      </div>
    </section>

    <!-- ═══ TAB: Analysis ═══ -->
    <section id="tab-analysis" class="tab-panel hidden space-y-4 fade-in">
      <div id="analysis-placeholder" class="glass rounded-xl p-8 text-center text-gray-500">
        Enter a symbol above and click <strong class="text-brand-500">AI Analyze</strong> to get a full analysis.
      </div>
      <div id="analysis-result" class="hidden space-y-4 fade-in">
        <!-- Data card -->
        <div id="analysis-data" class="glass rounded-xl p-5"></div>
        <!-- AI card -->
        <div class="glass rounded-xl p-5">
          <h2 class="text-white font-semibold mb-3">AI Analysis</h2>
          <div id="analysis-ai" class="ai-content text-sm leading-relaxed"></div>
        </div>
      </div>
      <div id="analysis-loading" class="hidden glass rounded-xl p-8 text-center">
        <div class="spinner mx-auto mb-3"></div>
        <p class="text-gray-400 text-sm">AI is analyzing... this may take 30-60 seconds</p>
      </div>
    </section>

    <!-- ═══ TAB: Portfolio ═══ -->
    <section id="tab-portfolio" class="tab-panel hidden space-y-4 fade-in">
      <!-- Add Holding -->
      <div class="glass rounded-xl p-4 flex flex-wrap gap-3 items-end">
        <div>
          <label class="text-xs text-gray-500 block mb-1">Symbol</label>
          <input id="pf-symbol" type="text" class="rounded-lg px-3 py-2 text-sm text-white uppercase w-24" maxlength="10" />
        </div>
        <div>
          <label class="text-xs text-gray-500 block mb-1">Shares</label>
          <input id="pf-shares" type="number" step="0.01" min="0" class="rounded-lg px-3 py-2 text-sm text-white w-24" />
        </div>
        <div>
          <label class="text-xs text-gray-500 block mb-1">Avg Cost</label>
          <input id="pf-cost" type="number" step="0.01" min="0" class="rounded-lg px-3 py-2 text-sm text-white w-28" />
        </div>
        <button onclick="addHolding()" class="px-4 py-2 bg-brand-600 hover:bg-brand-700 rounded-lg text-sm text-white transition">Add Holding</button>
        <button onclick="loadPortfolio()" class="px-4 py-2 bg-surface-600 hover:bg-surface-700 rounded-lg text-sm text-gray-300 transition ml-auto">Refresh</button>
      </div>

      <!-- Holdings Table -->
      <div class="glass rounded-xl p-5">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-white font-semibold">Holdings</h2>
          <div id="pf-totals" class="text-sm text-gray-400"></div>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="text-gray-500 text-left border-b border-white/5">
                <th class="pb-2 pr-4">Symbol</th>
                <th class="pb-2 pr-4">Shares</th>
                <th class="pb-2 pr-4">Avg Cost</th>
                <th class="pb-2 pr-4">Price</th>
                <th class="pb-2 pr-4">Value</th>
                <th class="pb-2 pr-4">Daily P&L</th>
                <th class="pb-2 pr-4">Unrealized</th>
                <th class="pb-2"></th>
              </tr>
            </thead>
            <tbody id="pf-table-body">
              <tr><td colspan="8" class="text-center text-gray-500 py-8">No holdings yet</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- AI Summary -->
      <div id="pf-ai-box" class="hidden glass rounded-xl p-5">
        <h2 class="text-white font-semibold mb-3">AI Portfolio Summary</h2>
        <div id="pf-ai-summary" class="ai-content text-sm leading-relaxed"></div>
      </div>
      <div id="pf-loading" class="hidden glass rounded-xl p-6 text-center">
        <div class="spinner mx-auto mb-3"></div>
        <p class="text-gray-400 text-sm">Loading portfolio data...</p>
      </div>
    </section>

    <!-- ═══ TAB: Alerts ═══ -->
    <section id="tab-alerts" class="tab-panel hidden space-y-4 fade-in">
      <!-- Create Alert -->
      <div class="glass rounded-xl p-4 flex flex-wrap gap-3 items-end">
        <div>
          <label class="text-xs text-gray-500 block mb-1">Symbol</label>
          <input id="alert-symbol" type="text" class="rounded-lg px-3 py-2 text-sm text-white uppercase w-24" maxlength="10" />
        </div>
        <div>
          <label class="text-xs text-gray-500 block mb-1">Condition</label>
          <select id="alert-condition" class="rounded-lg px-3 py-2 text-sm text-white w-28">
            <option value="above">Above</option>
            <option value="below">Below</option>
          </select>
        </div>
        <div>
          <label class="text-xs text-gray-500 block mb-1">Price</label>
          <input id="alert-price" type="number" step="0.01" min="0" class="rounded-lg px-3 py-2 text-sm text-white w-28" />
        </div>
        <button onclick="createAlert()" class="px-4 py-2 bg-brand-600 hover:bg-brand-700 rounded-lg text-sm text-white transition">Create Alert</button>
        <button onclick="checkAlerts()" class="px-4 py-2 bg-yellow-600/80 hover:bg-yellow-600 rounded-lg text-sm text-white transition">Check Now</button>
      </div>

      <!-- Alerts List -->
      <div class="glass rounded-xl p-5">
        <h2 class="text-white font-semibold mb-3">Active Alerts</h2>
        <div id="alerts-list" class="space-y-2">
          <p class="text-gray-500 text-sm text-center py-4">Loading alerts...</p>
        </div>
      </div>

      <!-- Check Result -->
      <div id="alert-check-result" class="hidden glass rounded-xl p-5 fade-in">
        <h2 class="text-white font-semibold mb-3">Alert Check Result</h2>
        <div id="alert-check-body"></div>
      </div>
    </section>

    <!-- ═══ TAB: Briefing ═══ -->
    <section id="tab-briefing" class="tab-panel hidden space-y-4 fade-in">
      <div class="glass rounded-xl p-5">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-white font-semibold">Morning Briefing</h2>
          <button onclick="runBriefing()" id="briefing-btn"
                  class="px-4 py-2 bg-brand-600 hover:bg-brand-700 rounded-lg text-sm text-white font-medium transition">
            Generate Briefing
          </button>
        </div>
        <div id="briefing-placeholder" class="text-gray-500 text-sm text-center py-8">
          Click <strong class="text-brand-500">Generate Briefing</strong> to get an AI-powered morning summary of your watchlist.
        </div>
        <div id="briefing-loading" class="hidden text-center py-8">
          <div class="spinner mx-auto mb-3"></div>
          <p class="text-gray-400 text-sm">Generating briefing... this may take 1-2 minutes</p>
        </div>
        <div id="briefing-result" class="hidden fade-in">
          <!-- Watchlist data cards -->
          <div id="briefing-cards" class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-5"></div>
          <!-- AI summary -->
          <div class="border-t border-white/5 pt-4">
            <h3 class="text-gray-400 text-xs uppercase tracking-wider mb-2">AI Summary</h3>
            <div id="briefing-ai" class="ai-content text-sm leading-relaxed"></div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- ── Footer ─────────────────────────────────────────────── -->
  <footer class="text-center text-xs text-gray-600 py-6 px-4">
    StockBot is for educational purposes only. Not financial advice. Data provided by Yahoo Finance.
  </footer>

  <script src="/static/app.js"></script>
</body>
</html>
